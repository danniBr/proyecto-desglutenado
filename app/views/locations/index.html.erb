<div class="container">
  <p id="notice"><%= notice %></p>

  <h1>locations</h1>

  <table>
    <thead>
      <tr>
        <th>Title</th>
        <th>Desc</th>
        <th colspan="3"></th>
      </tr>
    </thead>

    <tbody id="location">
      <%= render @locations %>
    </tbody>
  </table>

  <br>

  <%= link_to 'New location', new_location_path %>

  <div id="map" style="width:400px; height:400px"></div>
  <script>

    handler = Gmaps.build('Google');
    handler.buildMap({
      provider: {
       center: new google.maps.LatLng({lat: -33.5, lng: -70.7}),
       zoom: 10
      },
      internal: {
       id: 'map'
      }
    },
    function(){
     markers = handler.addMarkers(<%=raw @hash.to_json %>);
     google.maps.event.addListener(handler.getMap(), "center_changed", function(e){
       var new_center = handler.getMap().getCenter();
       var latitude = new_center.lat();
       var longitude = new_center.lng();

       $.ajax({
        url: '/locations',
        type: 'GET',
        dataType: 'script',
        data: {latitude: latitude, longitude: longitude}
       });
     });

    });
    </script>
</div>
